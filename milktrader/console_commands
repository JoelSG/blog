# R 2.12.2
# quantmod 0.3-16
# GNU bash 3.2.48(1)-release
# Data Source: http://finance.yahoo.com
# Symbol: ^GSPC 
# please send feedback to milktrader@gmail.com 

# source 

source("wasin.r")

# get data 

wasin()

# index out event, normalize for plot and define some variables

s          <- fat.data[fat.data$WAS.15 > .1]
spx        <- 1254.19  #close on close of last run == 10/24/2011
pos        <- nrow(s[s$IN.15 > 0  ])
neg        <- nrow(s[s$IN.15 < 0  ])
s$plot     <- spx + (spx*s$IN.15)

# prepare first plot

dens       <- density(na.omit(s$plot))
more       <- spx
less       <- more
max        <- 1600
min        <- 1000
x1         <- min(which(dens$x >= more))
x2         <- max(which(dens$x <  max))
x3         <- min(which(dens$x >= min))
x4         <- max(which(dens$x <  less))

# plot

plot(dens, xlab="Nov 14, 2011", ylab="", main="", yaxt="n")
with(dens, polygon(x=c(x[c(x1,x1:x2,x2)]), y= c(0, y[x1:x2], 0), col="goldenrod"))
with(dens, polygon(x=c(x[c(x3,x3:x4,x4)]), y= c(0, y[x3:x4], 0), col="goldenrod4"))
text(spx + 10, .0005, pos, cex=.75)
text(spx - 10, .0005, neg , cex=.75)
# text(1300, .002,  "â†“", cex=1.3) #location determined at the close 

# export file to shell

write.zoo(s$plot, file="out")

# import files from shell (see shell scripts in this commit)

month     <- read.table("month")
year      <- read.table("year")

# re-arrange the vector order for plotting

month[,c("V1","V2")] <- month[,c("V2","V1")]
year[,c("V1","V2")] <- year[,c("V2","V1")]

# plot frequency
plot(month, type="b", col="goldenrod4",  yaxp=c(1,25,6), xaxp=c(1,13,12), ylab="Frequency", xlab="Month", pch=23, bg="goldenrod", cex=1.2)
plot(year, type="b", col="goldenrod4",yaxp=c(1,25,6), ylab="Frequency", xlab="Year", pch=23, bg="goldenrod", cex=.7)

############# data for post
 
# s$IN.15 (cum returns after the close of 15-day rally)

1950-08-08  0.0065181966
1962-11-15  0.0460438830
1962-11-19  0.0350731383
1970-09-08  0.0130387541
1970-09-09  0.0098747592
1971-12-17  0.0373972328
1974-10-21  0.0363862756
1974-10-22  0.0224489796
1974-10-23  0.0073841105
1974-10-24  0.0326622554
1974-10-25  0.0404443179
1974-10-28  0.0255276669
1974-10-30 -0.0635727036
1975-01-30  0.0640693761
1975-02-10  0.0559582856
1975-02-11  0.0663603880
1975-02-12  0.0677017053
1975-02-13  0.0471721722
1975-02-14  0.0406122701
1975-02-18  0.0423312883
1976-01-15  0.0492123958
1980-11-24 -0.0694414492
1982-08-26  0.0526450077
1982-08-27  0.0337410375
1982-08-30  0.0461104944
1982-08-31  0.0613632500
1982-09-01  0.0374864028
1982-09-02  0.0470190275
1982-09-03  0.0251891263
1982-09-07  0.0076622106
1982-09-08  0.0154074318
1982-09-09 -0.0046644845
1982-09-10 -0.0127080430
1982-09-13  0.0082665124
1982-10-14  0.0450588838
1982-10-19  0.0271337673
1982-10-20  0.0471518524
1982-10-21  0.0138619550
1982-10-22  0.0193441680
1982-10-25  0.0050421379
1982-10-27  0.0069898870
1984-08-10  0.0064032862
1984-08-13  0.0076169750
1984-08-14 -0.0033246690
1984-08-15 -0.0007906581
1984-08-22 -0.0187689924
1987-01-22  0.0362156511
1987-01-23  0.0062429265
1987-12-28 -0.0005951672
1991-02-05  0.0415398748
1991-02-06  0.0469168138
1991-02-07  0.0251347502
1991-02-12  0.0220847577
1991-02-13  0.0291928865
1991-02-14  0.0186710747
1992-01-02  0.0024934666
1992-01-03 -0.0055121507
1992-01-06 -0.0092049411
1997-05-05  0.0418957649
1997-05-06  0.0233894182
1997-05-13  0.0093355299
1998-10-29  0.0715201902
1998-10-30  0.0614035895
1998-11-02  0.0590532189
1998-11-03  0.0689186758
1998-11-04  0.0649508480
1998-11-05  0.0609652534
1999-01-07 -0.0054780955
1999-11-17 -0.0114008464
2000-03-24 -0.0568566471
2000-03-29 -0.0438540057
2000-03-30 -0.0537281574
2001-04-26  0.0457700916
2001-04-27  0.0437173962
2001-05-01  0.0507179101
2001-05-02  0.0339060674
2001-10-12 -0.0121465606
2001-10-15 -0.0040763981
2002-08-13 -0.0285240097
2002-08-14  0.0103934586
2002-08-16 -0.0390540177
2002-08-27 -0.0785167994
2002-10-22 -0.0261525808
2002-10-28  0.0135687629
2002-10-29  0.0113790818
2002-10-30  0.0165391373
2002-10-31  0.0263160849
2002-11-01  0.0541907514
2008-12-15  0.0624850806
2009-03-24  0.0225781364
2009-03-25  0.0569890339
2009-03-26  0.0631788470
2009-03-27  0.0441130562
2009-03-30  0.0201607961
2009-03-31  0.0794255457
2009-04-01  0.0572524346
2009-04-02  0.0503526163
2009-04-03  0.0381720559
2009-04-06  0.0178160237
2009-04-07  0.0235553215
2009-04-14  0.0564903986
2009-07-29  0.0102590801
2009-07-30  0.0218530482
2009-07-31  0.0208968837
2009-08-03  0.0391400332
2009-08-04  0.0228798261
2009-08-05  0.0222244320
2011-10-25            NA

# year

1  1950  1
2  1962  2
3  1970  2
4  1971  1
5  1974  7
6  1975  7
7  1976  1
8  1980  1
9  1982 19
10 1984  5
11 1987  3
12 1991  6
13 1992  3
14 1997  3
15 1998  6
16 1999  2
17 2000  3
18 2001  6
19 2002 10
20 2008  1
21 2009 18
22 2011  1



# month 

1   1  8
2   2 12
3   3  9
4   4  8
5   5  5
6   7  3
7   8 17
8   9 10
9  10 24
10 11  9
11 12  3