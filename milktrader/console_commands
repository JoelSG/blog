# R 2.14.0
# quantmod 0.3-17
# SPX  data Source: http://yahoo.finance.com
# Symbols:  GSPC  
# please send feedback to milktrader@gmail.com 

# get SPX data 

getSymbols("^GSPC", from="1900-01-01")

# get a dataframe that has the year and that year's last 10-day return

years       <- seq(1950, 2010)

Out <- apply(expand.grid(years), 1, function(x){

  last_ten  <- exp(sum(dailyReturn(last(GSPC$GSPC.Close[as.character(x)], n=11) , type="log"))) -1

  return(c(x[1],last_ten))  
  
})

santa <- as.data.frame(t(Out))

# plotting details

spx         <- 1220
santa$plot  <- spx + (spx* santa$V2) 
gen         <- density(santa$plot)
max         <- 1500
min         <- 900
more        <- spx
less        <- more
x1          <- min(which(gen$x >= more))
x2          <- max(which(gen$x <  max))
x3          <- min(which(gen$x >= min))
x4          <- max(which(gen$x <  less))

# sanity test

test <- GSPC["1991"]
last(test, n=11)
(417.09-384.46)/384.46

# plot and save

png("path/to/file.png")
plot(gen, xlab="Dec 30, 2011", ylab="", main="", yaxt="n")
with(gen, polygon(x=c(x[c(x3,x3:x4,x4)]), y= c(0, y[x3:x4], 0), col="goldenrod4"))
with(gen, polygon(x=c(x[c(x1,x1:x2,x2)]), y= c(0, y[x1:x2], 0), col="goldenrod"))
text(1240, .0002, "45", cex=.7)
text(1205, .0002, "16", cex=.7)
dev.off()


#### DATA ####

  
 1950  0.0514668039  
 1951  0.0171159606  
 1952  0.0191791331  
 1953 -0.0060096154  
 1954  0.0300601202  
 1955  0.0093209055  
 1956  0.0036559140  
 1957 -0.0032402792  
 1958  0.0344762975  
 1959  0.0156011531  
 1960  0.0252293578  
 1961 -0.0059738816  
 1962  0.0084705130  
 1963  0.0096904441  
 1964  0.0143626571  
 1965  0.0033651759  
 1966 -0.0160460559  
 1967  0.0104744946  
 1968 -0.0345789180  
 1969  0.0260811413  
 1970  0.0270842621  
 1971  0.0235612593  
 1972 -0.0043016194  
 1973  0.0456640583  
 1974  0.0315979537  
 1975  0.0141684471  
 1976  0.0253816794  
 1977  0.0165686799  
 1978  0.0007288630  
 1979 -0.0089974293  
 1980  0.0395099541  
 1981  0.0010619180  
 1982  0.0394678492  
 1983  0.0202276383  
 1984  0.0279672998  
 1985 -0.0034902368  
 1986 -0.0314749640  
 1987 -0.0040309578  
 1988  0.0125419280  
 1989  0.0070384407  
 1990  0.0104032801  
 1991  0.0848722884  
 1992  0.0097098628  
 1993  0.0067121336  
 1994  0.0086309132  
 1995 -0.0016047462  
 1996  0.0274071403  
 1997  0.0024689062  
 1998  0.0579117682  
 1999  0.0355728161  
 2000 -0.0153997599  
 2001  0.0222511108  
 2002 -0.0335896309  
 2003  0.0342191177  
 2004  0.0072389691  
 2005 -0.0178214550  
 2006 -0.0050438796  
 2007  0.0002793011  
 2008 -0.0108740884  
 2009  0.0053372762  
 2010  0.0118837851  

