# R 2.14.0
# quantmod 0.3-17
# Gold data Source: prop data vendor and http://www.usagold.com
# SPX  data Source: http://yahoo.finance.com
# Symbols: spot gold, GSPC  
# please send feedback to milktrader@gmail.com 

# get gold data and add returns

g.2010   <- as.xts(read.zoo("2010", sep="\t", format="%m/%d/%y"))
g.2011   <- as.xts(read.zoo("2011", sep="\t", format="%m/%d/%y"))
gold     <- rbind(g.2010, g.2011)
GOLD     <- as.xts(read.zoo("~/Dropbox/DATA/IDXDATA/$GOLD.CSV", format="%m/%d/%Y", sep=","))
Gold     <- GOLD["::2009"]
G        <- rbind(Gold, gold)
names(G) <- "close"
G$RET    <- dailyReturn(Cl(G))  
G$ret    <- dailyReturn(Cl(G), type="log")  
G$two    <- exp( 
           lag(G$ret, k=-1) +
           lag(G$ret, k=-2) 
              ) - 1
# get SPX data and add returns

getSymbols("^GSPC", from="1900-01-01")
S        <- GSPC
S$RET    <- dailyReturn(Cl(S))  

# merge the two price series

T        <- na.omit(merge(S, G)) 

# subset strange event

t        <- T[T$RET < 0 & T$RET.1 < -0.03]

glitter  <- 1584.30
t$plot   <- glitter + (glitter * t$two)
gen      <- density(na.omit(t$plot))
max      <- 1900
min      <- 1100
more     <- glitter  
less     <- more
x1       <- min(which(gen$x >= more))
x2       <- max(which(gen$x <  max))
x3       <- min(which(gen$x >= min))
x4       <- max(which(gen$x <  less))

# plot and save

png("path/to/file.png")
plot(gen, xlab="Dec 16, 2011", ylab="", main="", yaxt="n")
with(gen, polygon(x=c(x[c(x3,x3:x4,x4)]), y= c(0, y[x3:x4], 0), col="purple4"))
with(gen, polygon(x=c(x[c(x1,x1:x2,x2)]), y= c(0, y[x1:x2], 0), col="purple"))
text(1550, .0002, "37", cex=.7)
text(1600, .0002, "53", cex=.7)
dev.off()


#### DATA ####

1970-10-29 -0.0143042913
1972-06-09 -0.0143312102
1972-09-18  0.0609260764
1973-02-26  0.0530864198
1973-05-16 -0.0093632959
1973-06-06 -0.0348932677
1973-08-13 -0.0782013685
1973-08-14  0.0782881002
1973-08-21 -0.0514150943
1973-10-01  0.0247295209
1973-11-14  0.0022148394
1974-01-10  0.0394846218
1974-02-28  0.0214987715
1974-04-08  0.0373580395
1974-05-28  0.0518470512
1974-05-31 -0.0146450175
1974-07-02 -0.0214936248
1974-07-10 -0.0125899281
1974-11-20  0.0094026549
1975-09-02  0.0274431058
1975-09-23  0.0446082234
1976-01-13  0.0037850114
1976-07-19 -0.0078843627
1976-07-20  0.0370370370
1976-08-18  0.0115633673
1978-01-05  0.0261587608
1978-08-21 -0.0229100658
1980-01-22 -0.0277966102
1980-01-25  0.0093562874
1980-01-31  0.0715926493
1980-02-22  0.0194444444
1980-03-10  0.0011965812
1980-03-13 -0.1302785265
1980-03-14 -0.0793499044
1980-03-17  0.0888429752
1980-03-21  0.0423809524
1980-03-26 -0.0354330709
1980-03-27  0.0200927357
1980-04-15  0.0311557789
1980-05-01  0.0510204082
1980-07-15  0.0125100888
1980-10-23  0.0041758588
1980-11-06 -0.0303797468
1980-12-10 -0.0280656304
1980-12-11  0.0381720430
1981-01-26 -0.0094607379
1981-01-29 -0.0005063291
1981-02-11 -0.0189620758
1981-04-07 -0.0218765192
1981-04-13  0.0052770449
1981-08-03 -0.0002547771
1982-03-08  0.0075642965
1982-04-20  0.0058309038
1982-06-21  0.0244313395
1982-07-26 -0.0149041874
1982-09-20  0.0459634649
1982-09-30 -0.0239294710
1982-10-04  0.0425806452
1982-10-15  0.0208092486
1983-02-22 -0.0216271885
1983-02-28  0.0526315789
1983-03-11  0.0332936980
1983-03-16  0.0065632458
1983-10-03  0.0012853470
1983-12-09  0.0011575563
1984-07-06 -0.0254777070
1985-02-25  0.0230430959
1986-09-11  0.0279850746
1986-11-17  0.0022929936
1990-08-28  0.0038634900
1990-10-16  0.0084989719
1993-08-05 -0.0156028369
1997-07-07 -0.0022012579
2000-01-04 -0.0074600355
2001-05-25 -0.0190045249
2006-06-13 -0.0289855072
2007-01-05  0.0001640689
2007-11-12  0.0124455507
2008-03-19 -0.0341679708
2008-08-12  0.0003057169
2008-09-02  0.0090795241
2008-09-09 -0.0524464343
2008-10-02  0.0275821596
2008-10-22 -0.0423387097
2008-11-20  0.1144986450
2008-12-01 -0.0151028278
2009-02-26  0.0008008542
2009-04-06  0.0112036771
2009-12-07 -0.0013129103
2011-09-22 -0.0720092915
