# R 2.14.0
# quantmod 0.3-17
# SPX  data Source: http://yahoo.finance.com
# Symbols:  GSPC  
# please send feedback to milktrader@gmail.com 

# get SPX data and subset 

getSymbols("^GSPC", from="1900-01-01")

G         <- GSPC
G$ret     <- dailyReturn(Cl(G), type="log")

Y         <- to.yearly(GSPC)
Y$RET     <- yearlyReturn(Cl(Y))
Y$RET[1,] <- (2043-1666)/1666 # special case for first year return
y         <- Y[,7]

# get cumulative returns for first five days of each year

years     <- seq(1950, 2011)
Out       <- apply(expand.grid(years), 1, function(x){
  firstfive <- exp(sum(first(G$ret[as.character(x)], n=5))) -1
  return(c(x[1],firstfive))  
})

five      <- as.data.frame(t(Out))

# combine first 5 days returns with yearly total

f         <- xts(five, order.by=index(y))
fy        <- merge(f,y)
fy        <- fy[,-1]
names(fy) <- c("five","year")

fy$myth   <- ifelse((fy$five < 0 & fy$year < 0) | (fy$five > 0 & fy$year >= 0), TRUE, FALSE)
fy$plot   <- ifelse(fy$myth == 1, abs(fy$year), ifelse(fy$year < 0, fy$year, -1*fy$year))

# sanity test

last1955 <- last(Cl(GSPC["1955"]))  
last1956 <- last(Cl(GSPC["1956"]))  

first(Cl(GSPC["1956"]), n=5)
(44.51 - last1955)/last1955
(last1956-last1955)/last1955

# plot and save

png("path/to/file.png")
barplot(fy$plot,  horiz=TRUE, names.arg=years, las=1, col=ifelse(fy$plot < 0, "goldenrod4", "goldenrod"),  cex.names=0.5, beside=TRUE)
text(0.3, .005, "44", cex=.6)
text(-0.2, .005, "18", cex=.6)

#### DATA ####

      first_five    yearly
1950  0.0252100840  0.0000000000    
1951  0.0279001468  0.1634850710    
1952  0.0021034918  0.1177955406    
1953 -0.0090327437 -0.0662401204    
1954  0.0048367594  0.4502216848    
1955 -0.0180655920  0.2640355753    
1956 -0.0213280563  0.0261653474    
1957 -0.0089993572 -0.1431326334    
1958  0.0250062516  0.3805951488    
1959  0.0034414055  0.0847672523    
1960 -0.0065119386 -0.0297211555    
1961  0.0120461194  0.2312854930    
1962 -0.0339622642 -0.1180992313    
1963  0.0259904913  0.1889064976    
1964  0.0130631832  0.1296987470    
1965  0.0073156342  0.0906194690    
1966  0.0076814887 -0.1309098777    
1967  0.0308726503  0.2009212000    
1968  0.0015548875  0.0766041256    
1969 -0.0294627383 -0.1136144810    
1970  0.0067347382  0.0009776233    
1971  0.0004340749  0.1078676072    
1972  0.0135174846  0.1563326477    
1973  0.0152477764 -0.1736552308    
1974 -0.0146591492 -0.2971809329    
1975  0.0215869312  0.3154900817    
1976  0.0486750194  0.1914846435    
1977 -0.0227991811 -0.1150195422    
1978 -0.0468980021  0.0106203996    
1979  0.0279887629  0.1230881282    
1980  0.0093570502  0.2577357791    
1981 -0.0198880377 -0.0973040660    
1982 -0.0244798042  0.1476132191    
1983  0.0322810011  0.1727104664    
1984  0.0240708179  0.0140059419    
1985 -0.0194331500  0.2633341306    
1986 -0.0156664142  0.1462040894    
1987  0.0623941859  0.0202750134    
1988 -0.0148939615  0.1240084183    
1989  0.0117384416  0.2725046810    
1990  0.0011035654 -0.0655913978    
1991 -0.0463933135  0.2630670462    
1992  0.0024215397  0.0446426431    
1993 -0.0152853962  0.0705515136    
1994  0.0073962911 -0.0153928610    
1995  0.0033966948  0.3411065386    
1996  0.0041076096  0.2026366633    
1997  0.0103545104  0.3100818101    
1998 -0.0148181734  0.2666859021    
1999  0.0373079082  0.1952604476    
2000 -0.0189076059 -0.1013918666    
2001 -0.0184960766 -0.1304268791    
2002  0.0110009755 -0.2336596753    
2003  0.0342229092  0.2638039599    
2004  0.0179869055  0.0899345277    
2005 -0.0212307743  0.0300102317    
2006  0.0335338743  0.1361943138    
2007 -0.0043643799  0.0352957766    
2008 -0.0532362636 -0.3848579367    
2009  0.0071740936  0.2345419319    
2010  0.0267958031  0.1278271007    
2011  0.0110206418 -0.0000318056    
