# R 2.12.2
# quantmod 0.3-16
# GNU bash, version 3.2.48(1)-release 
# Data Source: http://finance.yahoo.com
# Symbol: ^GSPC 
# please send feedback to milktrader@gmail.com 

# get data and add vectors

getSymbols("^GSPC", from="1900-01-01")
G       <- GSPC

# index out November and Wednesday and send to bash

G$RET  <- dailyReturn(Cl(G))
G$WED  <- weekdays(time(G)) == "Wednesday"
G$NOV  <- months(time(g)) == "November"
g      <- G[G$THU==1 & G$NOV==1]
write.zoo(g, "thanks")

# bring data back with 4th Thursday, merge and subset only returns

thanks <- read.zoo("thanksgiving", format="%Y-%m-%d")
H      <- merge(g, thanks, all=FALSE)
H$plot <- 1188 + (1188 * H$RET)

#prepare plot

gen     <- density(H$plot)
max     <- 1300
min     <- 1000
more    <- 1188
less    <- 1188
x1      <- min(which(gen$x >= more))
x2      <- max(which(gen$x <  max))
x3      <- min(which(gen$x >= min))
x4      <- max(which(gen$x <  less))

# plot and save

png("path/to/file.png")
plot(gen, xlab="Nov 23, 2011", ylab="", main="", yaxt="n")
with(gen, polygon(x=c(x[c(x3,x3:x4,x4)]), y= c(0, y[x3:x4], 0), col="goldenrod4"))
with(gen, polygon(x=c(x[c(x1,x1:x2,x2)]), y= c(0, y[x1:x2], 0), col="goldenrod"))
text(1185, .002, "13", cex=.7)
text(1190, .002, "48", cex=.7)
dev.off()



#### DATA ####

1950-11-22  0.0140845070
1951-11-21 -0.0017636684
1952-11-26  0.0063091483
1953-11-25  0.0008163265
1954-11-24  0.0055833088
1955-11-23  0.0013140604
1956-11-21 -0.0049008688
1957-11-27  0.0289348965
1958-11-26  0.0172481380
1959-11-25  0.0015693112
1960-11-23  0.0014357502
1961-11-22 -0.0011145166
1962-11-21  0.0059553350
1963-11-27 -0.0017960763
1964-11-25 -0.0033827132
1965-11-24  0.0017432992
1966-11-23  0.0067779591
1967-11-22  0.0059076262
1968-11-27  0.0046615700
1969-11-26  0.0035506779
1970-11-25  0.0036565228
1971-11-24  0.0018855368
1972-11-22  0.0059375269
1973-11-21  0.0111494020
1974-11-27  0.0067655103
1975-11-26  0.0025355529
1976-11-24  0.0044134955
1977-11-23  0.0041627641
1978-11-22  0.0049468477
1979-11-21  0.0019288263
1980-11-26  0.0060288524
1981-11-25  0.0043721156
1982-11-24  0.0071466185
1983-11-23  0.0007192520
1984-11-21  0.0020099890
1985-11-27  0.0093187821
1986-11-26  0.0024176975
1987-11-25 -0.0092942084
1988-11-23  0.0066988511
1989-11-22  0.0068317677
1990-11-21  0.0022834671
1991-11-27 -0.0037305535
1992-11-25  0.0037419023
1993-11-24  0.0028848448
1994-11-23 -0.0003554845
1995-11-22 -0.0030654405
1996-11-27 -0.0012699085
1997-11-26  0.0008624135
1998-11-25  0.0032798249
1999-11-24  0.0088563618
2000-11-22 -0.0185475192
2001-11-21 -0.0049270999
2002-11-27  0.0279861164
2003-11-26  0.0043268273
2004-11-24  0.0040953659
2005-11-23  0.0034728004
2006-11-22  0.0023381641
2007-11-21 -0.0159269292
2008-11-26  0.0353281471
2009-11-25  0.0045041378
2010-11-24  0.0149229714