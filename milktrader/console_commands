# R 2.12.2
# quantmod 0.3-16
# GNU bash, version 3.2.48(1)-release 
# Data Source: http://finance.yahoo.com
# Symbol: ^GSPC 
# please send feedback to milktrader@gmail.com 

# get data and add returns

getSymbols("^GSPC", from="1900-01-01")
G      <- GSPC
G$RET  <- dailyReturn(Cl(G))

# index out Black Friday

H      <- G[.indexmon(G)==10 & .indexmday(G) >= 23 & .indexmday(G) < 30 &.indexwday(G) == 5]

# bring in web-scraped historical Thanksgiving days for testing

thanks <- read.zoo("thankspython", format="%B-%d-%Y")

#prepare plot

H$plot <- 1161 + (1161* H$RET)
gen    <- density(H$plot)
max    <- 1300
min    <- 1000
more   <- 1161
less   <- 1161
x1     <- min(which(gen$x >= more))
x2     <- max(which(gen$x <  max))
x3     <- min(which(gen$x >= min))
x4     <- max(which(gen$x <  less))

# plot and save

png("path/to/file.png")
plot(gen, xlab="Nov 25, 2011", ylab="", main="", yaxt="n")
with(gen, polygon(x=c(x[c(x3,x3:x4,x4)]), y= c(0, y[x3:x4], 0), col="goldenrod4"))
with(gen, polygon(x=c(x[c(x1,x1:x2,x2)]), y= c(0, y[x1:x2], 0), col="goldenrod"))
text(1155, .002, "15", cex=.7)
text(1170, .002, "48", cex=.7)
dev.off()



#### DATA ####

1950-11-24  0.0079365079
1951-11-23 -0.0106007067
1952-11-28  0.0054858934
1953-11-27  0.0057096248
1954-11-26  0.0096434833
1955-11-25 -0.0008748906
1956-11-23  0.0105216029
1957-11-29  0.0113939394
1958-11-28  0.0111753372
1959-11-27  0.0045264624
1960-11-25  0.0059139785
1961-11-24  0.0019525802
1962-11-23  0.0120046045
1963-11-29  0.0135640138
1964-11-27 -0.0032771536
1965-11-26  0.0009788993
1966-11-25  0.0079790550
1967-11-24  0.0026695141
1968-11-29  0.0056607275
1969-11-28  0.0057896430
1970-11-27  0.0098719003
1971-11-26  0.0178235359
1972-11-24  0.0031650984
1973-11-23 -0.0032076985
1974-11-29  0.0004289391
1975-11-28  0.0032988784
1976-11-26  0.0072258568
1977-11-25  0.0020727537
1978-11-24  0.0032467532
1979-11-23  0.0075079411
1980-11-28  0.0024969680
1981-11-27  0.0083837162
1982-11-26  0.0074693756
1983-11-25  0.0013176809
1984-11-23  0.0146495654
1985-11-29 -0.0018267996
1986-11-28  0.0018088998
1987-11-27 -0.0154035231
1988-11-25 -0.0065799257
1989-11-24  0.0060249773
1990-11-23 -0.0029427586
1991-11-29 -0.0035320675
1992-11-27  0.0022600713
1993-11-26  0.0015139718
1994-11-25  0.0052452604
1995-11-24  0.0026236631
1996-11-29  0.0026754967
1997-11-28  0.0039510739
1998-11-27  0.0046003353
1999-11-26 -0.0003246112
2000-11-24  0.0146783024
2001-11-23  0.0117059356
2002-11-29 -0.0027266821
2003-11-28 -0.0002361944
2004-11-26  0.0007531140
2005-11-25  0.0020859506
2006-11-24 -0.0036555270
2007-11-23  0.0168905327
2008-11-28  0.0096431146
2009-11-27 -0.0172334621
2010-11-26 -0.0074686027
