# R 2.12.2
# quantmod 0.3-16
# Data Source: http://finance.yahoo.com
# Data Source: http://eia.gov
# Symbol: ^GSPC, WTI
# please send feedback to milktrader@gmail.com 

# source 

source("wasin.r")

# get data and merge

oil        <- as.xts(read.zoo("crude.csv", sep =",", format="%d-%b-%Y", skip=5, header=T))
wasin()
S          <- fat.data
C          <- oil[,1]
names(C)   <- "oil.close"
C$ret      <- dailyReturn(C$oil.close, type="log")
C$five.ago <- lag(C$ret) + lag(C$ret, k=2) + lag(C$ret, k=3) + lag(C$ret, k=4) + lag(C$ret, k=5) 
C$five.RET <- exp(C$five.ago) -1

# index out event and normalize for plot

CRUDE      <- C[C$five.RET > 0.13]
sc         <- merge(S, CRUDE, all=F)
spx        <- 1195.54
sc$plot    <- spx + (spx*sc$in.5)

# prepare plot

sen        <- density(na.omit(sc$plot))
more       <- spx
less       <- more
max        <- 1600
min        <- 1000
x1         <- min(which(sen$x >= more))
x2         <- max(which(sen$x <  max))
x3         <- min(which(sen$x >= min))
x4         <- max(which(sen$x <  less))

# plot spx

plot(sen, xlab="Oct 18, 2011", ylab="", main="", yaxt="n")
with(sen, polygon(x=c(x[c(x1,x1:x2,x2)]), y= c(0, y[x1:x2], 0), col="goldenrod"))
with(sen, polygon(x=c(x[c(x3,x3:x4,x4)]), y= c(0, y[x3:x4], 0), col="goldenrod4"))
text(1150, .0002, "33", cex=.75)
text(1240, .0002, "59", cex=.75)
text(1214, .002,  "â†“", cex=1.3) #location will change based on close

#### sc$in.5

1986-03-13  0.0131590264
1986-04-08  0.0378340550
1986-04-09  0.0180284344
1986-04-10  0.0362352941
1986-04-11  0.0278717645
1986-04-24 -0.0257704240
1986-04-25 -0.0283447649
1986-04-28 -0.0309546411
1986-05-08  0.0061843443
1986-05-09 -0.0113861595
1986-07-17  0.0155738054
1986-07-21  0.0163310205
1986-07-22 -0.0009735862
1986-08-05  0.0198737235
1986-08-06  0.0266211028
1986-08-07  0.0372825536
1986-08-08  0.0388542018
1986-08-11  0.0433552854
1988-10-17  0.0296188748
1988-11-28  0.0171387943
1989-04-21  0.0110715569
1989-04-24  0.0000968961
1990-07-13 -0.0003283713
1990-08-03 -0.0328325936
1990-08-06 -0.0270834542
1990-08-07  0.0131866160
1990-08-08  0.0136188514
1990-08-09  0.0050539382
1990-08-23  0.0241352077
1990-08-24  0.0379404677
1990-09-06 -0.0057030118
1990-09-07 -0.0056481308
1990-09-24 -0.0169279198
1990-09-25  0.0339801044
1990-09-26  0.0225459028
1990-09-27  0.0207827968
1990-09-28  0.0389407582
1990-10-10 -0.0202556539
1990-10-30  0.0421028223
1990-10-31  0.0248635138
1990-11-01  0.0066118421
1991-01-17  0.0444064902
1991-01-25  0.0273313818
1991-01-28  0.0207694825
1991-03-05  0.0098286086
1996-02-21  0.0102864278
1996-02-22 -0.0051689554
1996-02-23 -0.0279725587
1996-03-19 -0.0039990807
1996-03-20  0.0019641240
1996-04-12  0.0196932729
1998-03-24 -0.0017799279
1998-03-25 -0.0035273369
1998-03-26  0.0056446417
1998-03-27  0.0174509448
1998-03-30  0.0248849777
1998-05-01 -0.0149404093
1998-05-04 -0.0114719001
1998-05-28 -0.0086978017
1998-06-23  0.0319794056
1998-06-24  0.0128183369
1998-06-25  0.0138408304
1998-06-26  0.0151778124
1998-06-29  0.0212936816
1999-03-11  0.0085325293
2000-01-19 -0.0310004536
2000-01-20 -0.0355862353
2000-10-13  0.0443532013
2000-10-16  0.0165627251
2004-12-20  0.0089767208
2005-04-04  0.0070593050
2008-09-23 -0.0833989181
2008-09-24 -0.0183972665
2008-09-26 -0.0784829389
2008-12-30  0.0750845391
2008-12-31  0.0179758376
2009-01-02  0.0071740936
2009-01-05 -0.0444837948
2009-01-06 -0.0616637015
2009-01-07 -0.0673050177
2009-01-23  0.0213172205
2009-01-26 -0.0072961115
2009-01-27 -0.0133043260
2009-02-23 -0.0453996494
2009-02-26 -0.0680219637
2009-03-10  0.1143482181
2009-03-19  0.0245861396
2009-08-06  0.0030816180
2011-02-24  0.0007954719
2011-02-25  0.0190414210
2011-02-28  0.0009622087
2011-03-01 -0.0128765389
2011-10-12            NA
